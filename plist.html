<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>IPA → manifest.plist (OTA) — Web tĩnh</title>
<style>
body { margin:0; font-family: system-ui, -apple-system, sans-serif; background:#f5f6fa; color:#111; }
.container { max-width: 480px; margin:auto; padding:16px; }
h2 { text-align:center; margin-bottom:16px; }
.tabs { display:flex; margin-bottom:12px; border-radius:8px; overflow:hidden; }
.tab-btn { flex:1; padding:10px; border:none; cursor:pointer; font-weight:600; background:#eee; }
.tab-btn.active { background:#0b84ff; color:#fff; }
.card { background:#fff; padding:12px; border-radius:10px; margin-bottom:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
.input, .input-file, .btn { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; margin-bottom:8px; }
.input-file { padding:6px; }
.btn { border:none; background:#0b84ff; color:#fff; font-weight:600; cursor:pointer; }
.btn.secondary { background:#444; }
.status { padding:10px; border-radius:8px; background:#f0f4ff; margin-top:6px; white-space:pre-line; }
.status.error { background:#ffe6e6; color:#d9534f; border:1px solid #f5c6cb; }
.status.ok { background:#e6ffe6; color:#28a745; border:1px solid #c3e6cb; }
@media (max-width:420px){ .tabs { flex-direction:column; } }
</style>
</head>
<body>
<div class="container">
<h2>IPA → manifest.plist (OTA)</h2>
   <script src="https://altstudio.app/js/app-info-parser.min.js"></script>
  
<div class="tabs">
  <button id="tabUploadBtn" class="tab-btn active" onclick="switchTab('upload')">Upload IPA</button>
  <button id="tabUrlBtn" class="tab-btn" onclick="switchTab('url')">Dán link IPA</button>
</div>

<!-- Upload -->
<div id="tabUpload" class="card">
  <input type="file" id="fileInput" class="input-file" accept=".ipa">
  <div class="status" id="uploadStatus" style="display:none"></div>
</div>

<!-- URL -->
<div id="tabUrl" class="card" style="display:none">
  <input type="url" id="urlInput" class="input" placeholder="https://example.com/app.ipa">
  <div class="status" id="urlStatus" style="display:none"></div>
</div>

<!-- Info Form -->
<div class="card">
  <label>Bundle ID</label>
  <input type="text" id="bundleId" class="input" placeholder="com.example.app">

  <label>App Name</label>
  <input type="text" id="appName" class="input" placeholder="Tên ứng dụng">

  <label>Version</label>
  <input type="text" id="appVersion" class="input" placeholder="1.0">

  <label>IPA URL (HTTPS)</label>
  <input type="url" id="ipaUrl" class="input" placeholder="https://yourdomain.com/app.ipa">

  <label>Tên file manifest.plist</label>
  <input type="text" id="plistName" class="input" value="manifest.plist">

  <button class="btn" onclick="generatePlist()">Tạo manifest.plist</button>
  <div class="status" id="plistStatus" style="display:none"></div>
</div>

<!-- Download -->
<div id="downloadCard" class="card" style="display:none">
  <button class="btn" onclick="downloadPlist()">Tải manifest.plist</button>
  <button class="btn secondary" onclick="copyManifest()">Copy nội dung manifest</button>
  <div style="margin-top:8px;">
    <div>Link OTA gợi ý:</div>
    <pre id="otaLink" style="background:#f3f7ff;padding:6px;border-radius:6px;"></pre>
  </div>
</div>

<script>
let lastManifest = '';

function switchTab(name){
  document.getElementById('tabUpload').style.display = name==='upload'?'':'none';
  document.getElementById('tabUrl').style.display = name==='url'?'':'none';
  document.getElementById('tabUploadBtn').classList.toggle('active', name==='upload');
  document.getElementById('tabUrlBtn').classList.toggle('active', name==='url');
  hideStatus();
}

function hideStatus(){
  document.getElementById('uploadStatus').style.display='none';
  document.getElementById('urlStatus').style.display='none';
  document.getElementById('plistStatus').style.display='none';
}

function generatePlist(){
  hideStatus();
  const bundle = document.getElementById('bundleId').value.trim();
  const name = document.getElementById('appName').value.trim();
  const version = document.getElementById('appVersion').value.trim();
  const ipaUrl = document.getElementById('ipaUrl').value.trim();
  const plistFileName = document.getElementById('plistName').value.trim() || 'manifest.plist';

  if(!bundle || !name || !version || !ipaUrl){
    const s = document.getElementById('plistStatus'); s.style.display='block'; s.className='status error';
    s.textContent = '❌ Vui lòng điền đủ thông tin.';
    return;
  }

  const plistText = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
  <key>items</key>
  <array>
    <dict>
      <key>assets</key>
      <array>
        <dict>
          <key>kind</key>
          <string>software-package</string>
          <key>url</key>
          <string>${ipaUrl}</string>
        </dict>
      </array>
      <key>metadata</key>
      <dict>
        <key>bundle-identifier</key>
        <string>${bundle}</string>
        <key>bundle-version</key>
        <string>${version}</string>
        <key>kind</key>
        <string>software</string>
        <key>title</key>
        <string>${name}</string>
      </dict>
    </dict>
  </array>
</dict>
</plist>`;

  lastManifest = plistText;
  document.getElementById('plistStatus').style.display='block';
  document.getElementById('plistStatus').className='status ok';
  document.getElementById('plistStatus').textContent='✅ Manifest.plist đã tạo.';

  document.getElementById('downloadCard').style.display='';
  document.getElementById('otaLink').textContent = `itms-services://?action=download-manifest&url=https://yourdomain.com/${plistFileName}`;
}

function downloadPlist(){
  if(!lastManifest){ alert('Chưa tạo manifest'); return; }
  const plistFileName = document.getElementById('plistName').value.trim() || 'manifest.plist';
  const blob = new Blob([lastManifest], {type:'text/xml'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = plistFileName; a.click();
}

function copyManifest(){
  if(!lastManifest){ alert('Chưa tạo manifest'); return; }
  navigator.clipboard.writeText(lastManifest).then(()=> alert('Đã copy nội dung manifest vào clipboard.'));
}
</script>
</body>
</html>