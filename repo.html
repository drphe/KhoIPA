<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="mask-icon" href="./icon/logo.svg" color="#000000">
    <link rel="alternate icon" class="js-site-favicon" type="image/png" href="./icon/logo.png">
    <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="./icon/logo.svg">
    <title>KhoIPA || Qu·∫£n l√Ω JSON Repo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* T√πy ch·ªânh Tailwind CSS */
        body {
            font-family: 'Inter', sans-serif;
            background: #f0f4f8;
            color: #333;
        }

        .container {
            max-width: 640px !important;
            margin: 0px auto;
            margin-top: 20px;
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 20px;
            font-size: 20px !important;
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
            color: #333;
        }

        input,
        textarea {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            border: 1px solid #dcdcdc;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        input:focus,
        textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        input[type="color"],
        input[type="text"],
        input[type="date"] {
            padding: 0;
            height: 40px;
        }

        input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }

        button {
            margin-top: 20px;
            padding: 12px 20px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s, transform 0.1s;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* M√†u n√∫t */
        .btn-primary {
            background: #3498db;
            color: white;
            padding: 4px;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-edit {
            background: #2ecc71;
            color: white;
        }

        .btn-edit:hover {
            background: #27ad60;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-delete:hover {
            background: #c0392b;
        }

        .btn-cancel {
            background: #f39c12;
            color: white;
        }

        .btn-cancel:hover {
            background: #e67e22;
        }

        /* N√∫t Import/Export */
        .btn-import {
            background: #34495e;
            color: white;
        }

        .btn-import:hover {
            background: #2c3e50;
        }

        .btn-download {
            background: #27ae60;
            color: white;
        }

        .btn-download:hover {
            background: #219d55;
        }

        /* Danh s√°ch */
        .news-item,
        .app-item,
        .version-item {
            background: #ecf0f1;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid #3498db;
        }

        .news-item strong,
        .app-item strong {
            color: #2c3e50;
        }

        .item-actions {
            display: flex;
        }

        .item-actions button {
            margin-left: 8px;
            margin-top: 0;
            padding: 8px 12px;
            font-size: 14px;
        }

        .form-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .form-group>div {
            flex: 1 1 30%;
            min-width: 200px;
        }

        /* Tabs */
        .tab-buttons button {
            margin: 0 5px;
            padding: 6px 25px;
            font-size: 16px;
            background: #bdc3c7;
            color: #333;
            border-radius: 8px 8px 0 0;
        }

        .tab-buttons button.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            border: 1px solid #dcdcdc;
            padding: 20px;
            border-radius: 0 0 12px 12px;
            margin-bottom: 20px;
        }

        /* Textarea Output */
        #output {
            min-height: 250px;
            background: #f9f9f9;
            font-size: 13px;
            padding: 10px;
        }

        #nav-bar {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            border-bottom: 0.1px solid var(--color-separator);
            background-color: var(--color-transparent);
            -webkit-backdrop-filter: saturate(100%) blur(30px);
            backdrop-filter: saturate(100%) blur(20px);
            min-width: 0;
            margin: 0 auto;
            padding: 0.25em 16px 0.25em 16px;
            z-index: 2;
            min-height: 40px;
        }

        #top {
            position: fixed;
            z-index: 5;
            left: 0;
            right: 0;
            top: 0;
            max-width: 640px;
            margin: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="top">
            <div id="nav-bar" class="">
                <a href="../KhoIPA/" target="_blank" class="" title="Kho IPA Mod">üîô</a>
                <div id="title" class="">
                    <p>üõ†Ô∏è Qu·∫£n l√Ω Json Repository</p>
                </div>
                <a href="https://github.com/drphe/KhoIPA" target=_blank id="source-code">
                    <img src="https://komarev.com/ghpvc/?username=drphe&amp;repo=KhoIPA&amp;label=Views&amp;color=blue&amp;style=flat" alt="Repo Views">
                </a>
            </div>
        </div>

        <!-- TAB NAVIGATION -->
        <div class="tab-buttons" style="display: flex;">
            <button class="active" onclick="showTab('news', this)">Tin t·ª©c</button>
            <button onclick="showTab('apps', this)">·ª®ng d·ª•ng</button>
        </div>

        <!-- NEWS TAB CONTENT -->
        <div id="newsTab" class="tab-content">
            <h2 class="text-xl font-semibold mb-4">Qu·∫£n l√Ω Tin t·ª©c</h2>

            <label for="news_title">Ti√™u ƒë·ªÅ (*):</label>
            <input type="text" id="news_title" placeholder="Ti√™u ƒë·ªÅ tin t·ª©c">

            <label for="news_identifier">Id tin t·ª©c (*):</label>
            <input type="text" id="news_identifier" placeholder="Id c·ªßa tin t·ª©c">

            <label for="news_caption">Caption (*):</label>
            <input type="text" id="news_caption" placeholder="M√¥ t·∫£ ng·∫Øn">

            <label for="news_imageURL">Link ·∫£nh b√¨a (*):</label>
            <input type="text" id="news_imageURL" placeholder="URL ·∫£nh b√¨a">

            <label for="news_url">Link tin t·ª©c :</label>
            <input type="text" id="news_url" placeholder="URL tin t·ª©c">

            <div class="form-group">
                <div>
                    <label for="news_tintColor">M√£ m√†u:</label>
                    <input type="color" id="news_tintColor" value="#3498db">
                </div>
                <div>
                    <label for="news_appID">App ID (*):</label>
                    <input type="text" id="news_appID" value="com.example.app" placeholder="Bundle ID ·ª©ng d·ª•ng li√™n quan">
                </div>
                <div>
                    <label for="news_date">Ng√†y (*):</label>
                    <input type="date" id="news_date">
                </div>
            </div>

            <label class="flex items-center mt-4">
                <input type="checkbox" id="news_notify"> Notify
            </label>

            <button onclick="addOrUpdateNews()" class="btn-primary">Th√™m / C·∫≠p nh·∫≠t tin</button>
            <button onclick="cancelNewsEdit()" id="cancelNewsBtn" class="btn-cancel" style="display:none;">Tho√°t ch·ªânh s·ª≠a</button>

            <div class="news-list" id="newsList">
                <h3 class="font-bold text-lg mt-6">Danh s√°ch Tin t·ª©c</h3>
            </div>
        </div>

        <!-- APPS TAB CONTENT -->
        <div id="appsTab" class="tab-content" style="display:none;">
            <h2 class="text-xl font-semibold mb-4">Qu·∫£n l√Ω ·ª®ng d·ª•ng</h2>

            <div class="form-group">
                <div>
                    <label for="app_name">T√™n App (*):</label>
                    <input type="text" id="app_name">
                </div>
                <div>
                    <label for="app_bundleIdentifier">Bundle ID (*):</label>
                    <input type="text" id="app_bundleIdentifier" placeholder="V√≠ d·ª•: com.example.app">
                </div>
                <div>
                    <label for="app_developerName">Nh√† ph√°t tri·ªÉn :</label>
                    <input type="text" id="app_developerName">
                </div>
            </div>

            <div class="form-group">
                <div>
                    <label for="app_subtitle">Ph·ª• ƒë·ªÅ (*): </label>
                    <input type="text" id="app_subtitle">
                </div>
                <div>
                    <label for="app_iconURL">Icon URL (*): </label>
                    <input type="text" id="app_iconURL">
                </div>
                <div>
                    <label for="app_tintColor">M√£ m√†u: </label>
                    <input type="color" id="app_tintColor" value="#000000">
                </div>
            </div>

            <label for="app_localizedDescription">M√¥ t·∫£ (*): </label>
            <textarea id="app_localizedDescription" rows="3"></textarea>

            <label for="app_screenshotURLs">Screenshot URLs (NgƒÉn c√°ch b·∫±ng d·∫•u ph·∫©y): </label>
            <textarea id="app_screenshotURLs" rows="2" placeholder="url1, url2, url3"></textarea>

            <label class="flex items-center mt-4"><input type="checkbox" id="app_beta"> Beta</label>

            <button onclick="addOrUpdateApp()" class="btn-primary">Th√™m / C·∫≠p nh·∫≠t App</button>
            <button onclick="cancelAppEdit()" id="cancelAppBtn" class="btn-cancel" style="display:none;">Tho√°t ch·ªânh s·ª≠a</button>

            <!-- Versions Management Section -->
            <div id="versionSection" class="mt-6 pt-4 border-t border-gray-200" style="display:none;">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">Qu·∫£n l√Ω Phi√™n b·∫£n (Versions)</h3>
                <div class="form-group">
                    <div>
                        <label for="version_number">Version (*):</label>
                        <input type="text" id="version_number">
                    </div>
                    <div>
                        <label for="version_date">Ng√†y & Gi·ªù (*):</label>
                        <input type="datetime-local" id="version_date">
                    </div>
                    <div>
                        <label for="version_size">K√≠ch th∆∞·ªõc (*) (bytes): </label>
                        <input type="number" id="version_size" min="1" placeholder="V√≠ d·ª•: 50003343">
                    </div>
                </div>
                <label for="version_downloadURL">Download URL (*): <blink><a href="https://github.com/drphe/KhoIPA/releases/new" target=_blank>>>Upload t·ªáp ·ªü ƒë√¢y</a></blink></label>
                <input type="text" id="version_downloadURL">

                <label for="version_localizedDescription">M√¥ t·∫£ Version</label>
                <textarea id="version_localizedDescription" rows="3"></textarea>

                <button onclick="addOrUpdateVersion()" class="btn-edit mt-3">Th√™m / C·∫≠p nh·∫≠t Version</button>
                <button onclick="cancelVersionEdit()" id="cancelVersionBtn" class="btn-cancel" style="display:none;">Tho√°t ch·ªânh s·ª≠a Version</button>

                <div class="version-list" id="versionList">
                    <h4 class="font-bold text-md mt-6">Danh s√°ch Versions</h4>
                </div>
            </div>

            <div class="app-list" id="appList">
                <h3 class="font-bold text-lg mt-6">Danh s√°ch ·ª®ng d·ª•ng</h3>
            </div>
        </div>

        <!-- OUTPUT AND ACTIONS -->
        <label for="output" class="mt-6">üì¶ M√£ JSON xu·∫•t ra</label>
        <textarea id="output" placeholder="M√£ json s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y!"></textarea>
        <div class="flex justify-between items-center mt-4">
            <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="handleFileSelect(event)">
            <button onclick="document.getElementById('jsonFileInput').click()" class="btn-import">
                ‚¨ÜÔ∏è Import File G·ªëc (.json)
            </button>
            <button onclick="downloadJSON()" class="btn-download">
                ‚¨áÔ∏è T·∫£i xu·ªëng repo.json
            </button>
        </div>
    </div>

    <!-- Custom Alert and Confirm Modals -->
    <div id="customAlertModal" style="display:none;"></div>
    <div id="customConfirmModal" style="display:none;"></div>
    <script>
        // --- D·ªØ li·ªáu v√† Bi·∫øn tr·∫°ng th√°i ---
        let newsArray = [];
        let appsArray = [];
        let newsEditIndex = -1;
        let appEditIndex = -1;
        let versionEditIndex = -1;

        let baseData = '';
        // Kh·ªüi t·∫°o ng√†y m·∫∑c ƒë·ªãnh
        document.getElementById('news_date').value = new Date().toISOString().split('T')[0];

        // --- Custom UI functions (Thay th·∫ø alert/confirm) ---
        function showCustomAlert(message) {
            let alertBox = document.getElementById('customAlertModal');
            if (alertBox) alertBox.remove();

            alertBox = document.createElement('div');
            alertBox.id = 'customAlertModal';
            alertBox.className = 'fixed top-4 right-4 bg-red-600 text-white p-4 rounded-lg shadow-xl font-semibold opacity-0 transition-opacity duration-500 z-50';
            alertBox.textContent = message;
            document.body.appendChild(alertBox);

            setTimeout(() => {
                alertBox.classList.remove('opacity-0');
                alertBox.classList.add('opacity-100');
            }, 10); // Ngay l·∫≠p t·ª©c

            setTimeout(() => {
                alertBox.classList.remove('opacity-100');
                alertBox.classList.add('opacity-0');
                setTimeout(() => alertBox.remove(), 500);
            }, 3000);
        }

        function showCustomConfirm(message, callback) {
            const existingModal = document.getElementById('customConfirmModal');
            if (existingModal) existingModal.remove();

            const modal = document.createElement('div');
            modal.id = 'customConfirmModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50';

            const box = document.createElement('div');
            box.className = 'bg-white p-6 rounded-lg shadow-2xl w-80 text-center';

            const msg = document.createElement('p');
            msg.textContent = message;
            msg.className = 'mb-5 font-medium text-gray-800';
            box.appendChild(msg);

            const btnContainer = document.createElement('div');
            btnContainer.className = 'flex justify-center space-x-4';

            const btnYes = document.createElement('button');
            btnYes.textContent = 'ƒê·ªìng √Ω X√≥a';
            btnYes.className = 'btn-delete !mt-0';
            btnYes.onclick = () => {
                modal.remove();
                callback(true);
            };

            const btnNo = document.createElement('button');
            btnNo.textContent = 'H·ªßy';
            btnNo.className = 'btn-cancel !mt-0';
            btnNo.onclick = () => {
                modal.remove();
                callback(false);
            };

            btnContainer.appendChild(btnYes);
            btnContainer.appendChild(btnNo);
            box.appendChild(btnContainer);
            modal.appendChild(box);
            document.body.appendChild(modal);
        }

        // --- Ch·ª©c nƒÉng Qu·∫£n l√Ω TAB ---
        function showTab(tabName, element) {
            document.getElementById('newsTab').style.display = tabName === 'news' ? 'block' : 'none';
            document.getElementById('appsTab').style.display = tabName === 'apps' ? 'block' : 'none';

            // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t
            document.querySelectorAll('.tab-buttons button').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');

            // ·∫®n ph·∫ßn version khi chuy·ªÉn tab ho·∫∑c kh√¥ng edit app
            document.getElementById('versionSection').style.display = 'none';
        }

        // --- Ch·ª©c nƒÉng Qu·∫£n l√Ω NEWS ---
        function addOrUpdateNews() {
            const title = document.getElementById('news_title').value.trim();
            const identifier = document.getElementById('news_identifier').value.trim();
            const caption = document.getElementById('news_caption').value.trim();
            const imageURL = document.getElementById('news_imageURL').value.trim();
            const url = document.getElementById('news_url').value.trim();
            const tintColor = document.getElementById('news_tintColor').value.replace('#', '').toUpperCase();
            const appID = document.getElementById('news_appID').value.trim();
            const date = document.getElementById('news_date').value;
            const notify = document.getElementById('news_notify').checked;

            if (!title || !caption || !imageURL || !appID || !identifier) {
                showCustomAlert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin tin t·ª©c.");
                return;
            }

            const newsItem = {
                title,
                identifier,
                caption,
                tintColor,
                imageURL,
                appID,
                date,
                notify,
                url
            };
            if (newsItem.url === "") {
                delete newsItem.url;
            }
            if (newsEditIndex >= 0) {
                newsArray[newsEditIndex] = newsItem;
                newsEditIndex = -1;
                document.getElementById('cancelNewsBtn').style.display = 'none';
            } else {
                newsArray.unshift(newsItem); // Th√™m v√†o ƒë·∫ßu ƒë·ªÉ tin m·ªõi nh·∫•t n·∫±m tr√™n
            }

            clearNewsForm();
            renderNewsList();
            updateOutput();
        }

        function clearNewsForm() {
            document.getElementById('news_title').value = '';
            document.getElementById('news_identifier').value = '';
            document.getElementById('news_caption').value = '';
            document.getElementById('news_imageURL').value = '';
            document.getElementById('news_url').value = '';
            document.getElementById('news_tintColor').value = '#3498db';
            document.getElementById('news_appID').value = 'com.example.app';
            document.getElementById('news_date').value = new Date().toISOString().split('T')[0];
            document.getElementById('news_notify').checked = false;
        }

        function renderNewsList() {
            const list = document.getElementById('newsList');
            list.innerHTML = '<h3 class="font-bold text-lg mt-6">Danh s√°ch Tin t·ª©c</h3>';
            // S·∫Øp x·∫øp l·∫°i tin t·ª©c theo ng√†y (m·ªõi nh·∫•t l√™n ƒë·∫ßu)
            const sortedNews = [...newsArray].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedNews.forEach((item, index) => {
                const originalIndex = newsArray.indexOf(item); // T√¨m index g·ªëc
                const div = document.createElement('div');
                div.className = 'news-item';
                div.style.borderLeftColor = '#' + item.tintColor;
                div.innerHTML = `
                    <span><strong>${item.title}</strong> - ${item.caption} (${item.date})</span>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editNews(${originalIndex})">S·ª≠a</button>
                        <button class="btn-delete" onclick="deleteNews(${originalIndex})">X√≥a</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function editNews(index) {
            const item = newsArray[index];
            document.getElementById('news_title').value = item.title;
            document.getElementById('news_identifier').value = item.identifier;
            document.getElementById('news_caption').value = item.caption;
            document.getElementById('news_imageURL').value = item.imageURL;
            document.getElementById('news_url').value = item.url;
            document.getElementById('news_tintColor').value = '#' + item.tintColor;
            document.getElementById('news_appID').value = item.appID;
            document.getElementById('news_date').value = item.date;
            document.getElementById('news_notify').checked = item.notify;
            newsEditIndex = index;
            document.getElementById('cancelNewsBtn').style.display = 'inline-block';
        }

        function deleteNews(index) {
            showCustomConfirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a tin n√†y?", (confirmed) => {
                if (confirmed) {
                    newsArray.splice(index, 1);
                    renderNewsList();
                    updateOutput();
                }
            });
        }

        function cancelNewsEdit() {
            newsEditIndex = -1;
            clearNewsForm();
            document.getElementById('cancelNewsBtn').style.display = 'none';
        }

        // --- Ch·ª©c nƒÉng Qu·∫£n l√Ω APPS ---
        function addOrUpdateApp() {
            const name = document.getElementById('app_name').value.trim();
            const bundleIdentifier = document.getElementById('app_bundleIdentifier').value.trim();
            const developerName = document.getElementById('app_developerName').value.trim();
            const subtitle = document.getElementById('app_subtitle').value.trim();
            const iconURL = document.getElementById('app_iconURL').value.trim();
            const tintColor = document.getElementById('app_tintColor').value.replace('#', '').toUpperCase();
            const localizedDescription = document.getElementById('app_localizedDescription').value.trim();
            const screenshotURLsInput = document.getElementById('app_screenshotURLs').value.trim();
            const beta = document.getElementById('app_beta').checked;

            if (!name || !bundleIdentifier || !developerName || !subtitle || !iconURL) {
                showCustomAlert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin App b·∫Øt bu·ªôc (T√™n, Bundle ID, Developer, Subtitle, Icon URL).");
                return;
            }

            const screenshotURLs = screenshotURLsInput ? screenshotURLsInput.split(',').map(url => url.trim()).filter(url => url) : [];

            let appItem = {
                beta,
                name,
                bundleIdentifier,
                developerName,
                subtitle,
                localizedDescription,
                iconURL,
                tintColor: tintColor.startsWith('#') ? tintColor.substring(1) : tintColor,
                screenshotURLs
            };

            let currentAppVersions = [];

            if (appEditIndex >= 0) {
                const existingApp = appsArray[appEditIndex];
                currentAppVersions = existingApp.versions || [];

                // C·∫≠p nh·∫≠t c√°c tr∆∞·ªùng c·ªë ƒë·ªãnh
                appItem = {
                    ...existingApp,
                    ...appItem
                };

            } else {
                appItem.versions = [];
            }

            // G√°n appItem v√†o m·∫£ng
            if (appEditIndex >= 0) {
                appsArray[appEditIndex] = updateAppLatestVersion(appItem);
                appEditIndex = -1;
                document.getElementById('cancelAppBtn').style.display = 'none';
                document.getElementById('versionSection').style.display = 'none';
            } else {
                appsArray.unshift(updateAppLatestVersion(appItem)); // Th√™m v√†o ƒë·∫ßu
            }

            clearAppForm();
            renderAppList();
            updateOutput();
        }

        function clearAppForm() {
            document.getElementById('app_name').value = '';
            document.getElementById('app_bundleIdentifier').value = '';
            document.getElementById('app_developerName').value = '';
            document.getElementById('app_subtitle').value = '';
            document.getElementById('app_iconURL').value = '';
            document.getElementById('app_tintColor').value = '#000000';
            document.getElementById('app_localizedDescription').value = '';
            document.getElementById('app_screenshotURLs').value = '';
            document.getElementById('app_beta').checked = false;
        }

        function renderAppList() {
            const list = document.getElementById('appList');
            list.innerHTML = '<h3 class="font-bold text-lg mt-6">Danh s√°ch ·ª®ng d·ª•ng</h3>';
            appsArray.forEach((item, index) => {
                const versionCount = (item.versions || []).length;
                const latestVersion = item.version || 'N/A';
                const div = document.createElement('div');
                div.className = 'app-item';
                div.style.borderLeftColor = '#' + item.tintColor;
                div.innerHTML = `
                    <span>
                        <strong>${item.name}</strong> (${item.bundleIdentifier}) - Phi√™n b·∫£n: ${latestVersion} 
                        <span class="text-sm text-gray-500">(${versionCount} versions)</span>
                    </span>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editApp(${index})">S·ª≠a</button>
                        <button class="btn-delete" onclick="deleteApp(${index})">X√≥a</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function editApp(index) {
            const item = appsArray[index];
            document.getElementById('app_name').value = item.name;
            document.getElementById('app_bundleIdentifier').value = item.bundleIdentifier;
            document.getElementById('app_developerName').value = item.developerName;
            document.getElementById('app_subtitle').value = item.subtitle;
            document.getElementById('app_iconURL').value = item.iconURL;
            document.getElementById('app_tintColor').value = '#' + item.tintColor;
            document.getElementById('app_localizedDescription').value = item.localizedDescription;
            document.getElementById('app_screenshotURLs').value = (item.screenshotURLs || []).join(', ');
            document.getElementById('app_beta').checked = item.beta;

            appEditIndex = index;
            document.getElementById('cancelAppBtn').style.display = 'inline-block';
            document.getElementById('versionSection').style.display = 'block';

            // Render versions cho app ƒëang ch·ªânh s·ª≠a
            renderVersionList(item.versions || []);
            clearVersionForm();
        }

        function deleteApp(index) {
            showCustomConfirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ·ª©ng d·ª•ng n√†y v√† t·∫•t c·∫£ versions c·ªßa n√≥?", (confirmed) => {
                if (confirmed) {
                    appsArray.splice(index, 1);
                    renderAppList();
                    updateOutput();
                    if (appEditIndex === index) {
                        cancelAppEdit();
                    }
                }
            });
        }

        function cancelAppEdit() {
            appEditIndex = -1;
            clearAppForm();
            document.getElementById('cancelAppBtn').style.display = 'none';
            document.getElementById('versionSection').style.display = 'none';
            versionEditIndex = -1;
        }

        // --- Ch·ª©c nƒÉng Qu·∫£n l√Ω Versions ---

        function clearVersionForm() {
            document.getElementById('version_number').value = '';
            document.getElementById('version_date').value = '';
            document.getElementById('version_size').value = '';
            document.getElementById('version_downloadURL').value = '';
            document.getElementById('version_localizedDescription').value = '';
            versionEditIndex = -1;
            document.getElementById('cancelVersionBtn').style.display = 'none';
        }

        function renderVersionList(versions) {
            const list = document.getElementById('versionList');
            list.innerHTML = '<h4 class="font-bold text-md mt-6">Danh s√°ch Versions</h4>';

            // S·∫Øp x·∫øp versions theo ng√†y m·ªõi nh·∫•t
            const sortedVersions = [...versions].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedVersions.forEach((item, index) => {
                const originalIndex = versions.indexOf(item); // T√¨m index g·ªëc
                const datePart = item.date ? item.date.substring(0, 10) : 'N/A';
                const sizeMB = item.size ? (item.size / 1024 / 1024).toFixed(2) + ' MB' : 'N/A';

                const div = document.createElement('div');
                div.className = 'version-item';
                div.innerHTML = `
                    <span>
                        <strong>v${item.version}</strong> (${datePart}) - K√≠ch th∆∞·ªõc: ${sizeMB}
                    </span>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editVersion(${originalIndex})">S·ª≠a</button>
                        <button class="btn-delete" onclick="deleteVersion(${originalIndex})">X√≥a</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function addOrUpdateVersion() {
            if (appEditIndex < 0) {
                showCustomAlert("Vui l√≤ng ch·ªçn ho·∫∑c th√™m App tr∆∞·ªõc khi th√™m Version.");
                return;
            }

            const version = document.getElementById('version_number').value.trim();
            const dateInput = document.getElementById('version_date').value;
            const size = parseInt(document.getElementById('version_size').value, 10);
            const downloadURL = document.getElementById('version_downloadURL').value.trim();
            const localizedDescription = document.getElementById('version_localizedDescription').value.trim();

            if (!version || !dateInput || isNaN(size) || size <= 0 || !downloadURL) {
                showCustomAlert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin Version b·∫Øt bu·ªôc (Version, Ng√†y, K√≠ch th∆∞·ªõc > 0, Download URL).");
                return;
            }

            // Chuy·ªÉn date/time local sang chu·ªói ISO 8601
            const date = new Date(dateInput).toISOString().replace(/\.\d{3}Z$/, 'Z');

            const versionItem = {
                version,
                date,
                size,
                downloadURL,
                localizedDescription
            };

            let currentApp = appsArray[appEditIndex];
            currentApp.versions = currentApp.versions || [];

            if (versionEditIndex >= 0) {
                currentApp.versions[versionEditIndex] = versionItem;
            } else {
                currentApp.versions.push(versionItem);
            }

            // C·∫≠p nh·∫≠t th√¥ng tin app v·ªõi version m·ªõi nh·∫•t
            appsArray[appEditIndex] = updateAppLatestVersion(currentApp);

            clearVersionForm();
            renderVersionList(appsArray[appEditIndex].versions);
            renderAppList();
            updateOutput();
        }

        function updateAppLatestVersion(app) {
            if ((app.versions || []).length > 0) {
                // S·∫Øp x·∫øp ƒë·ªÉ t√¨m version m·ªõi nh·∫•t
                app.versions.sort((a, b) => new Date(b.date) - new Date(a.date));
                const latestVersion = app.versions[0];

                app.version = latestVersion.version;
                app.versionDate = latestVersion.date;
                app.versionDescription = latestVersion.localizedDescription;
                app.downloadURL = latestVersion.downloadURL;
                app.size = latestVersion.size;
            }
            return app;
        }


        function editVersion(index) {
            const versions = appsArray[appEditIndex].versions;
            if (!versions || index < 0 || index >= versions.length) return;

            const item = versions[index];
            document.getElementById('version_number').value = item.version;

            const dateObj = new Date(item.date);
            const localDate = new Date(dateObj.getTime() - (dateObj.getTimezoneOffset() * 60000)).toISOString().slice(0, 16);
            document.getElementById('version_date').value = localDate;

            document.getElementById('version_size').value = item.size;
            document.getElementById('version_downloadURL').value = item.downloadURL;
            document.getElementById('version_localizedDescription').value = item.localizedDescription;

            versionEditIndex = index;
            document.getElementById('cancelVersionBtn').style.display = 'inline-block';
        }

        function deleteVersion(index) {
            showCustomConfirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a version n√†y?", (confirmed) => {
                if (confirmed) {
                    let currentApp = appsArray[appEditIndex];
                    currentApp.versions.splice(index, 1);

                    appsArray[appEditIndex] = updateAppLatestVersion(currentApp);

                    renderVersionList(currentApp.versions);
                    renderAppList();
                    updateOutput();
                    clearVersionForm();
                }
            });
        }

        function cancelVersionEdit() {
            clearVersionForm();
        }

        // --- Ch·ª©c nƒÉng IMPORT/EXPORT ---

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!importedData || !Array.isArray(importedData.news) || !Array.isArray(importedData.apps)) {
                        showCustomAlert("L·ªói Import: File JSON kh√¥ng h·ª£p l·ªá ho·∫∑c thi·∫øu m·∫£ng 'news'/'apps'.");
                        return;
                    }

                    // C·∫≠p nh·∫≠t d·ªØ li·ªáu to√†n c·ª•c
                    baseData = importedData;
                    newsArray = baseData.news;
                    appsArray = baseData.apps;

                    // G√°n l·∫°i references trong baseData
                    baseData.news = newsArray;
                    baseData.apps = appsArray;

                    // C·∫≠p nh·∫≠t giao di·ªán
                    renderNewsList();
                    renderAppList();
                    updateOutput();
                    showCustomAlert("Import file g·ªëc th√†nh c√¥ng! D·ªØ li·ªáu ƒë√£ s·∫µn s√†ng ƒë·ªÉ ch·ªânh s·ª≠a.");
                    // Reset input ƒë·ªÉ c√≥ th·ªÉ ch·ªçn l·∫°i c√πng m·ªôt file
                    event.target.value = '';

                } catch (error) {
                    console.error("L·ªói ph√¢n t√≠ch c√∫ ph√°p JSON:", error);
                    showCustomAlert("L·ªói Import: Kh√¥ng th·ªÉ ph√¢n t√≠ch c√∫ ph√°p file JSON. Vui l√≤ng ki·ªÉm tra ƒë·ªãnh d·∫°ng.");
                }
            };
            reader.readAsText(file);
        }

        function downloadJSON() {
            const jsonText = document.getElementById('output').value;
            const filename = 'repo.json';
            const blob = new Blob([jsonText], {
                type: 'application/json'
            });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();

            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        // --- Ch·ª©c nƒÉng OUTPUT ---
        function updateOutput() {
            // baseData.news v√† baseData.apps ƒë√£ l√† tham chi·∫øu, ƒë·∫£m b·∫£o ch√∫ng tr·ªè ƒë·∫øn c√°c m·∫£ng hi·ªán t·∫°i
            baseData.news = newsArray;
            baseData.apps = appsArray;
            document.getElementById('output').value = JSON.stringify(baseData, null, 2);
        }
        // kh·ªüi t·∫°o
        fetchRepoData();
        async function fetchRepoData() {
            try {
                const response = await fetch('repo.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                // C·∫≠p nh·∫≠t d·ªØ li·ªáu to√†n c·ª•c
                baseData = await response.json();
                newsArray = baseData.news;
                appsArray = baseData.apps;

                // G√°n l·∫°i references trong baseData
                baseData.news = newsArray;
                baseData.apps = appsArray;

                // C·∫≠p nh·∫≠t giao di·ªán
                renderNewsList();
                renderAppList();
                updateOutput();
            } catch (error) {
                showCustomAlert("L·ªói khi t·∫£i repo.json");

            }
        }
    </script>
</body>

</html>